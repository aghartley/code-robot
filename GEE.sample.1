##################################################################
#A Sample of R-code I wrote to run Generalized Estimating Equations 
#(GEEs) and obtain plots of the predicted values
###################################################################


gee.1 <- function(){
  
  ############
  #load packages
  ############
  require(foreign)
  require(car)
  require(nlme)
  require(multilevel)
  require(lme4)
  library(geepack)
  require(gee)
  require(foreign)
  
  ##############################
  #readin in data
  ##############################
  options(digits=3)
  
  #x <- read.spss("neo.video.study.longform.sav",use.value.labels=F,to.data.frame=T)
  x <- read.spss("neo.audio.study.longform.sav",use.value.labels=F,to.data.frame=T)
  print("sample of data")
  #print(x[1:10,1:10])
  print(x)

  
 
  ######################
  #center the predictors
  ######################
  
  #COME BACK TO TIME CETNERING ISSUE
  #x$time <- x$time - mean(x$time,na.rm=T) #other way you can do this is time -1. come back to this.
  #x$e <- x$event - mean(x$event,na.rm=T)
  #x$r <- x$reaction - mean(x$reaction,na.rm=T)
  #x$subject <- x$subject
  #x$gender <- x$gender - mean(x$gender,na.rm=T)
  
  x$time[x$time == 1] <- -.5
  x$time[x$time == 2] <-  .5
  
  x$event[x$event == 1] <- -.5
  x$event[x$event == 2] <-  .5
  
  x$reaction[x$reaction == 1] <- -.5
  x$reaction[x$reaction == 2] <-  .5
  
#   print(x$time)
#   print(x$event)
#   print(x$reaction)
#   stop()
  
  x$e <- x$event
  x$r <- x$reaction
  

  print("here is the data after centering")
  #print(x[1:10,1:10])
  #print(x)
  df2 <- data.frame(time = x$time, event = x$e, reaction = x$r)
  print(df2)

  
  #sets the padding around each plot and all plots
  
  par(mfrow=c(3,1))
  par(mai=c(.3,.2,.2,.2))
  par(oma=c(1.2,1.3,.1,.5))
  
  #################################
  #Now plot each depedent variable:
  #################################
  x$DV <- x$neo.agree.rev

  gee.2(Y_MIN=2,
        Y_MAX=25,
	  #Y_MAX=28,
        PLOT_TITLE_A="(A) FFI Agreeableness",
        X_LABEL="",
        YAXIS_TICKS_LABELS=c("5","10","15","20","25"),
        YAXIS_TICKS_COR=c(5,10,15,20,25),
        input.data=x
        )

#TURNING OFF OVERALL BEHAVIOR FOR THIS MANUSCRIPT
#   x$DV <- x$ov.behavior
#   
#   ## LEFT OFF HERE
#   
#   gee.2(
#         Y_MIN=0,
#         Y_MAX=3.5,
#         PLOT_TITLE_A="(B) Overall Behavior",
#         X_LABEL="Time",
#         YAXIS_TICKS_LABELS=c("0.5","1.5","2.5","3.5"),
#         YAXIS_TICKS_COR=c(.5,1.5,2.5,3.5),
#         input.data=x
#         )
  
  x$DV <- x$reactions.disagree
  
  gee.2(
    Y_MIN=.9,
    Y_MAX=4.0,    
    #Y_MIN=1.2,
    #Y_MAX=4.5,
    PLOT_TITLE_A="(B) Reaction",
    X_LABEL="",
    Y_LABEL="Mean Rating",
    #YAXIS_TICKS_LABELS=c("1.5","2.5","3.5","4.5"),
    #YAXIS_TICKS_COR=c(1.5,2.5,3.5,4.5),
    YAXIS_TICKS_LABELS=c("1.0","2.0","3.0","4.0"),
    YAXIS_TICKS_COR=c(1.0,2.0,3.0,4.0),
    input.data=x
    )
  
  x$DV <- x$events.all

  gee.2(
        Y_MIN=.8,
        Y_MAX=3.2,
	  #Y_MIN=1.0,
        #Y_MAX=3.0,
        PLOT_TITLE_A="(C) Event",
        X_LABEL="Time",
        Y_LABEL="Mean Rating",
        YAXIS_TICKS_LABELS=c("1.0","1.5","2.0","2.5","3.0"),
        YAXIS_TICKS_COR=c(1.0,1.5,2.0,2.5,3.0),
        input.data=x
        )
  


  

  
  
}
